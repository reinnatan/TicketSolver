<!DOCTYPE html>
<html lang="en" xmlns:th="https://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

</head>
<body style="height:100%; padding:0;margin:0;">

    <div id="demoMap" style="height:70vh; width:100%;">

    </div>
    <div style="height:30vh; width:100%;">
        <!--information link of datatable : https://datatables.net/examples/api/row_details.html-->
        <table id="ticketTaskTable" class="table table-striped table-bordered data">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Title</th>
                    <th>Description</th>
                    <th>Is Solved</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="ticketTask : ${ticketTasks} ">
                    <td><span th:text="${ticketTask.id}"/></td>
                    <td><span th:text="${ticketTask.title}"/></td>
                    <td><span th:text="${ticketTask.descriptions}"/></td>
                    <td><span th:text="${ticketTask.isSolved}"/></td>
                </tr>
            </tbody>
        </table>
    </div>


    <!--
    <script src="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.4.3/build/ol.js"></script>
    <script type="text/javascript">
      var map = new ol.Map({
        target: 'demoMap',
        layers: [
          new ol.layer.Tile({
            source: new ol.source.OSM()
          })
        ],
        view: new ol.View({
          center: ol.proj.fromLonLat([37.41, 8.82]),
          zoom: 4
        })
      });
    </script>
    -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.4.3/css/ol.css" type="text/css"/>
    <!--<link rel="stylesheet" type="text/css" media="screen" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css">-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap4.min.css" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js"></script>
    <script>
    $(document).ready(function() {
        $('#ticketTaskTable').DataTable(
            //{
            //"processing": true,
            //"serverSide": true,
            //"ajax": "http://localhost:8080/ticket-tasks-view"
            //}
        );
    });


    function myMap() {
        const balikpapan = { lat: -1.1742562, lng: 116.7016577 };
        var mapProp= {
          center:balikpapan, //new google.maps.LatLng(51.508742,-0.120850),
          zoom:13,
        };
        var map = new google.maps.Map(document.getElementById("demoMap"),mapProp);

        //mapping markers
        mappingMarkers(map);
    }

    function mappingMarkers(map){
        $.get("/ticket-tasks", function(data, status){
            var infowindow = new google.maps.InfoWindow();
            //binding mapping marker positions
            for(var i=0; i<data.length; i++){
                var marker = new google.maps.Marker({
                    position: new google.maps.LatLng(data[i].latitude, data[i].longitude),
                    map: map,
                    //icon:'images/map_marker_icon.png', //path of image iocn
                });


                //add event listener onclick for each marker
                google.maps.event.addListener(marker, 'click', (function(marker, i) {
                    return function() {
                      var teamMember = "<div><b>Team Members</b></div>";
                      for (var j=0; j<data[i].teamSolverList.length; j++){
                        teamMember = teamMember+"<div> ID : "+data[i].teamSolverList[j].id+"</div>"+
                        "<div> Name : "+data[i].teamSolverList[j].name+"</div>";
                      }

                      const content = "<div><b>Ticket Task Information</b></div><div> Title : "+data[i].title+"</div>"+
                      "<div> Description : "+data[i].descriptions+"</div>"+
                      "<div> Status : "+data[i].solved+"</div><br/>"+teamMember;

                      infowindow.setContent(content);
                      infowindow.open(map, marker);
                    }
                })(marker, i));
            }

        });
    }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBZhMDgzBinwJ0Tu8IPtFTI_CEAOZLLj28&callback=myMap"></script>

</body>
</html>