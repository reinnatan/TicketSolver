<!DOCTYPE html>
<html lang="en" xmlns:th="https://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

</head>
<body style="height:100%; padding:0;margin:0;">

    <div id="demoMap" style="height:50vh; width:100%;">

    </div>
    <div style="height:50vh; width:100%;background-color:yellow;">
        <!--information link of datatable : https://datatables.net/examples/api/row_details.html-->
       <table border="1">
           <thead>
           <tr>
               <th>ID</th>
               <th>Title</th>
               <th>Description</th>
               <th>Is Solved</th>
           </tr>
           </thead>
           <tbody>
                <tr th:each="ticketTask : ${ticketTasks} ">
                    <td><span th:text="${ticketTask.id}"/></td>
                    <td><span th:text="${ticketTask.title}"/></td>
                    <td><span th:text="${ticketTask.descriptions}"/></td>
                    <td><span th:text="${ticketTask.isSolved}"/></td>
                </tr>
           </tbody>
       </table>
    </div>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.4.3/css/ol.css" type="text/css"/>

    <!--
    <script src="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.4.3/build/ol.js"></script>
    <script type="text/javascript">
      var map = new ol.Map({
        target: 'demoMap',
        layers: [
          new ol.layer.Tile({
            source: new ol.source.OSM()
          })
        ],
        view: new ol.View({
          center: ol.proj.fromLonLat([37.41, 8.82]),
          zoom: 4
        })
      });
    </script>
    -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
    function myMap() {
        const uluru = { lat: -2.319775, lng: 99.4158336 };
        var mapProp= {
          center:uluru, //new google.maps.LatLng(51.508742,-0.120850),
          zoom:6,
        };
        var map = new google.maps.Map(document.getElementById("demoMap"),mapProp);

        //mapping markers
        mappingMarkers(map);
    }

    function mappingMarkers(map){
        $.get("/ticket-tasks", function(data, status){
            var infowindow = new google.maps.InfoWindow();
            //binding mapping marker positions
            for(var i=0; i<data.length; i++){
                var marker = new google.maps.Marker({
                    position: new google.maps.LatLng(data[i].latitude, data[i].longitude),
                    map: map,
                    //icon:'images/map_marker_icon.png', //path of image iocn
                });

                var teamMember = "<div><b>Team Members</b></div>";
                for (var j=0; j<data[i].teamSolverList.length; j++){
                    teamMember = teamMember+"<div> ID : "+data[i].teamSolverList[j].id+"</div>"+
                    "<div> Name : "+data[i].teamSolverList[j].name+"</div>";
                }

                //add event listener onclick for each marker
                google.maps.event.addListener(marker, 'click', (function(marker, i) {
                    return function() {
                      const content = "<div><b>Ticket Task Information</b></div><div> Title : "+data[i].title+"</div>"+
                      "<div> Description : "+data[i].descriptions+"</div>"+
                      "<div> Status : "+data[i].solved+"</div><br/>"+teamMember;

                      infowindow.setContent(content);
                      infowindow.open(map, marker);
                    }
                })(marker, i));
            }

        });
    }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBZhMDgzBinwJ0Tu8IPtFTI_CEAOZLLj28&callback=myMap"></script>

</body>
</html>